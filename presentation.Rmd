---
title: "RMarkdown and Version Control with git"
author: "Lukas Schmid, Chân Lê"
date: "17 1 2020"
output: html_document
---

# __Introduction to R Markdown__

------

## __1. General__
RMarkdown can be used to save and execute codes, as well as generate high-quality reports to be shared with the audience.

A (newer version) cheatsheet of RMarkdown can be found here: https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf

## __2. Installation__

#### __a. Prerequisite__
Make sure that you have the __latest version of R and RStudio__. It was not officially mentioned on the RMarkdown official guide, but I did run into troubles trying to install RMarkdown without knowing that some conflicts could exist if you were not to get R in your computer updated.


#### __b. Install RMarkdown__
Next you can install RMarkdown package in R:

```{r eval = F}
# Install from CRAN
install.packages('rmarkdown')

# Or if you want to test the development version,
# install from GitHub
if (!requireNamespace("devtools"))
  install.packages('devtools')
devtools::install_github('rstudio/rmarkdown')
```


#### __c. LaTeX for PDF output__
If you want to generate PDF output, you will need to install LaTeX. For R Markdown users who have not installed LaTeX before, you can install TinyTeX (https://yihui.name/tinytex/):

```{r eval = F}
install.packages("tinytex")
tinytex::install_tinytex()  # install TinyTeX
```


## __3. Basics__

#### __a. Text formating__

The following code chunks present how text should look like when written in 
Markdown. To prevent the text from actually being formatted, we put it into
code chunks.

```{r eval = F}
Write normally for plain text 
```

Write normally for plain text

```{r eval = F}
> You can highlight some chunk of text or blockquotes with the greater-than sign
```

> You can highlight some chunk of text or blockquotes with the greater-than sign

```{r eval = F}
Italics using *single asterisks* or _single underscores_
```

Italics using *single asterisks* or _single underscores_

```{r eval = F}
Bold using **double asterisks** or __double underscore__
```

Bold using **double asterisks** or __double underscore__

```{r eval = F}
You can have different sizes of header with the number sign #

# Header 1   
## Header 2   
### Header 3   
#### Header 4   
##### Header 5   
###### Header 6

Alternatively, for H1, an underline-ish style:

Alt-H1

------
```

# Header 1   
## Header 2   
### Header 3   
#### Header 4   
##### Header 5   
###### Header 6

Alternatively, for H1, an underline-ish style:


Alt-H1

------

```{r eval = F}
Inline code blocks are highlighted using back-ticks, for example the package `ggplot2` 

```

Inline code blocks are highlighted using back-ticks, for example the package `ggplot2` 



```{r eval = F}
* You can create bullet points by setting an asterisk, just remember **the space between the asterisk and your text**:
  + Then add first sub-point with a plus sign
  + Another sub-point
    - Then a sub-sub-point using minus sign
```

* You can create bullet points by setting an asterisk, just remember **the space between the asterisk and your text**:
  + Then add first sub-point with a plus sign
  + Another sub-point
    - Then a sub-sub-point using minus sign
    
Bullet points need to have double line breaks before the former block of text. 
Continued lists have no double line breaks. Single line breaks will be ignored.

```{r eval = F}
1. You can create numbered list with, well, numbers.
2. Something something
   i) A sub-point (with three spaces at the beginning, to get the indentation)
   ii) Yet another sub-point
```

1. You can create numbered list with, well, numbers.
2. Something something
   i) A sub-point (with three spaces at the beginning, to get the indentation)
   ii) Yet another sub-point


### __b. Chunk code & Chunk options__

For all of this chapter and of course much more, see [https://bookdown.org/yihui/rmarkdown/r-code.html](chapter 2.6 in the
Definitive Guide to R Markdown.)

If you want to execute your code in RMarkdown, put them into code chunk brackets
(but don't normally put them as a comment - we just did this to demonstrate how
it should look). You can get the brackes by  ___pressing Ctrl + ALt + I__ ).

```{r eval = F}
  #```{r}
  test <- rnorm(20, mean = 0, sd = 3)
  mean(test)
  sd(test)
  # ```
```

Chunks have chunk options that change their behaviour when knitted. By default,
code in all chunks will be run by R, the code will be displayed in the final
Markdown-document and the outputs (if any) will be displayed. There are some
useful options to change this behaviour (standard behaviour is mentioned):

- `eval = TRUE`: Run code in chunk
- `echo = TRUE`: display the source code in the document
- `results = markup`: how to display the results of a code chunk
- `include = TRUE`: Include anything from the code at all (`include = FALSE` is equal to `echo = FALSE, results = 'hide', warning = FALSE, message = FALSE`)

Additionally, the first option in a code chunk can be the label of that chunk.
Labels are useful when you have lots of them and try to debug your document; 
they will also be used for filenames in plots.

And finally, you can also run code inline. So, if I want to report the mean of 
some variable directly in the text, I can write `#r mean(cars$speed)` (without
the hashtag) to get the result, `r mean(cars$speed)`.

### __c. formatting tables__

By default, R output looks like this:

```{r}
# a linear regression:
lm(speed ~ dist, cars)
# some data:
iris[1:5, ]
```

This is not exactly pretty reporting. But you can report results in a way that
is more readable (be sure to have `knitr` installed):

```{r}
knitr::kable(iris[1:5, ], caption = 'A caption')
```

Advanced formatting of tables (e.g. their alignement, stretching over multiple
pages...) in PDFs can be more cumbersome. Here, we only reference to
[https://bookdown.org/yihui/rmarkdown/r-code.html#tables](chapter
2.6.2 in the Markdown Guide). Vignettes on how to use kableExtra can be found on
the [CRAN-page](https://cran.r-project.org/web/packages/kableExtra/index.html).

When it comes to reporting results, plain `knitR` is not enough. There are
multiple packages available to do this ([see some examples
here](https://rmarkdown.rstudio.com/lesson-7.html)); I have used `stargazer` in
the past, which is especially useful in PFDs. It generates HTML-Code (or LaTeX-
code) directly from R-code. Due to this, we need a workaround: we always want
the result of stargazer to be displayed as is. This way, the results (now in)
HTML) will be read by the browser to be displayed as a table. An example helps:

```{r}
# This will only give us some HTML-formatted text:
stargazer::stargazer(lm(speed ~ dist, cars), type ="html")
```

```{r results='asis'}
# We now have the chunk-option results='asis':
stargazer::stargazer(lm(speed ~ dist, cars), type ="html")
```


### __d. printing plots__

It wll come as now surprise to you that plots will automatically be displayed:

```{r fig.cap="Caption"}
library(ggplot2)
ggplot(mtcars, aes(cyl, mpg, group=cyl)) +
  geom_boxplot()
```

Using code chunk options, you can add captions to the table
(`fig.cap="Caption`). Size of plots is generally controlled by code chunk options and can be really exhausting. I can not tell you more than this
[very good blog entry](https://sebastiansauer.github.io/figure_sizing_knitr/) does. Sizing figures will remain a tedious task and has to be
done by hand, that is for sure.

# version control with git

## general principle

Git is a version control software for line-based data (that means, you can
version control things like .txt, .csv, LaTeX, R, and other code, but not 
formats like .PDF, .docx, .xlsx, ar images). It is useful because it is (comparatively) simple and not storage-intensive.

You can use it locally, but you can also connect it to specialised websites 
(like  [GitHub](https://github.com/) or [BitBucket](https://bitbucket.org/)) - 
this ultimately means that you have an opportunity to back-up all of your code,
for no money, on the internet (and I think it is relatively secure, so your
code will not be stolen). GitHub also has a good 
[education plan](https://education.github.com/pack) which gives you
access to some cool programs.

## How it works

Many examples on the web use git from your command line. This is probably a
skill worth to learn at some point; however, you can do without - and as one 
website out it, "no one is handing out nerd badges", so using the command line 
because it looks cool is probably stupid (though we all do it, of course). So
here come only the basic basics.

### 1. Creating a repsository

Git relies on so-called repositories. For us, they are simply folders that 
contain an additional `.git` folder and sometimes a `.gitignore` file, and of 
course everything you cant to version-control.

You can create a repository locally on your computer. If you want to use that
repository online, you can later push it to an online service. If you want to
use it online from the start, better create the repository online and then 
'clone' it to your machine.

### 2. Applying changes

Whenever something changes in your repository, you have to first **add** the changes to your index. Because the index is the staging area (german: Zwischenschritt), this is also called **staging**. After changes are added, they
are not yet safed! To actually apply changes, you have to **commit** them. When
committing, you have to specify a commit message that usually contains info 
about what you have done in that commit. 

If you use an online repo, you have to **push** those changes (to the server) so
they not only exist on your local machine.

### 3. Workflow

Of course, if you work online, you also have to check for changes on the server
(though this is less of an issue if you work alone on only one machine). This is
called to **pull**. As a result, we can summarise the following ideal workflow:

1. Pull to sync your local repo with the online repo.
2. Work.
3. Stage changes (whenever it seems reasonable; these can be very small steps!
The more and smaller steps you stage and commit, the higher is the change that
you can return to a well working version of your code.)
4. Commit the changes.
5. Push the changes.
6. Repeat 2 to 6 until you're done.

### 4. Branches and merges

When you pull and there are changes in the online repo, these changes will
automatically be applied to your code. In some cases (e.g. the same line has
been changed in the online and the local repo, but in different ways), you have
to manually resolve these merge conflicts. This usually means to decide which
line should be used.

When more than one person works on a code, it is advisable to branch. This means
that effects in one branch won't affect any other branch. However, due to time
and ressource constraints, we won't cover this topic here.

## Appendix: glossary

- working directory: contains all your files
- repo: short for repository
- to clone a repo: copy an existing online-repo to your local machine
- HEAD: the last version of your repo (or the branch you are currently in); not
the same as the working directory
- index: the staging area where you 'park' changes until you commit them
- to stage or add change: to apply changes to the index
- to commit changes: to add changes from the index to the HEAD, thus making them
visible 
- to push changes: to add changes from your local repo to the online repo
- to pull changes: to add changes from your online repo to the local repo